!function(){"use strict";var e=window.wp.element,t=window.wp.hooks,n=window.wp.components,l=window.wp.i18n,a=window.wp.coreData,s=window.wp.data,o=window.wp.notices;function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},i.apply(this,arguments)}const r={string:n.TextControl,select:n.SelectControl,boolean:n.ToggleControl,array:n.FormTokenField};function c(t){var n,l;let{type:a,description:s,value:o,required:i,onChange:c,help:d,...g}=t;const p={label:s,required:null!=i&&i,help:d||null};let h=e.Fragment;switch(a){case"string":h=null!=g&&null!==(n=g.enum)&&void 0!==n&&n.length?r.select:r.string,p.value=o||"",p.onChange=e=>c(e),null!=g&&null!==(l=g.enum)&&void 0!==l&&l.length&&(p.options=null==g?void 0:g.enum.map((e=>({label:e.charAt(0).toUpperCase()+e.slice(1),value:e}))));break;case"integer":h=r.string,p.value=o?parseInt(o):"",p.onChange=e=>c(parseInt(e)),p.type="number";break;case"boolean":h=r.boolean,p.checked=o||!1,p.onChange=e=>c(e);break;case"array":h=r.array,p.onChange=e=>c(e),p.tokenizeOnSpace=!0,p.value=o||[]}const u=h;return(0,e.createElement)(u,p)}function d(t){var l,s,o,r,d;let{clientSlug:g,optionsKey:p,options:h,setOption:u}=t;const[_]=(0,a.useEntityProp)("root","site","wpgraphql_login_settings_show_advanced_settings"),m=["id","order"],v=(null===(l=wpGraphQLLogin)||void 0===l||null===(s=l.settings[g])||void 0===s||null===(o=s.properties)||void 0===o||null===(r=o[p])||void 0===r?void 0:r.properties)||{},E=null===(d=Object.keys(v))||void 0===d?void 0:d.sort(((e,t)=>v[e].order>v[t].order?1:-1));return(0,e.createElement)(e.Fragment,null,null==E?void 0:E.map((t=>{var l;return m.includes(t)||!_&&null!==(l=v[t])&&void 0!==l&&l.advanced?null:(0,e.createElement)(n.PanelRow,{key:t},(0,e.createElement)(c,i({},v[t],{value:null==h?void 0:h[t],onChange:e=>{u({[t]:e})}})))})))}const g={name:"New client",order:0,isEnabled:!1,clientOptions:{clientId:"",clientSecret:"",redirectUri:""},loginOptions:{createUserIfNoneExists:!0}};function p(t){var o,i,r;let{clientSlug:c}=t;const{saveEditedEntityRecord:p}=(0,s.useDispatch)(a.store),[h,u]=(0,a.useEntityProp)("root","site",c);(0,e.useEffect)((()=>{var e;void 0!==h&&0===(null===(e=Object.keys(h||{}))||void 0===e?void 0:e.length)&&u({...g,slug:c.replace("wpgraphql_login_provider_","")})}),[h,u,c]);const{lastError:_}=(0,s.useSelect)((e=>({lastError:e(a.store).getLastEntitySaveError("root","site"),isSaving:e(a.store).isSavingEntityRecord("root","site"),hasEdits:e(a.store).hasEditsForEntityRecord("root","site")})),[h]);(0,e.useEffect)((()=>{var e,t;_&&(0,s.dispatch)("core/notices").createErrorNotice((0,l.sprintf)(
// translators: %s: Error message.
(0,l.__)("Error saving settings: %s","wp-graphql-headless-login"),(null==_||null===(e=_.data)||void 0===e||null===(t=e.params)||void 0===t?void 0:t[c])||(null==_?void 0:_.message)),{type:"snackbar",isDismissible:!0})}),[_,c]);const m=(e,t)=>{const n={...h,[e]:t};u(n)};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.PanelBody,null,(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("h2",{className:"components-panel__body-title"},(0,l.sprintf)(
// translators: %s: Client slug.
(0,l.__)("%s Settings.","wp-graphql-headless-login"),(null===(o=wpGraphQLLogin)||void 0===o||null===(i=o.settings)||void 0===i||null===(r=i[c])||void 0===r?void 0:r.title)||"Client"))),(0,e.createElement)(n.ToggleControl,{checked:null==h?void 0:h.isEnabled,label:(0,l.__)("Enable Provider.","wp-graphql-headless-login"),onChange:e=>m("isEnabled",e)}),(0,e.createElement)(n.TextControl,{label:(0,l.__)("Client Label.","wp-graphql-headless-login"),onChange:e=>m("name",e),value:null==h?void 0:h.name,required:!0}),(0,e.createElement)(d,{clientSlug:c,optionsKey:"clientOptions",options:null==h?void 0:h.clientOptions,setOption:e=>{m("clientOptions",{...null==h?void 0:h.clientOptions,...e})}})),(0,e.createElement)(n.PanelBody,null,(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("h2",{className:"components-panel__body-title"},(0,l.__)("Login Settings.","wp-graphql-headless-login"),(0,e.createElement)(n.Icon,{icon:"admin-users",className:"components-panel__icon",size:20}))),(0,e.createElement)(d,{clientSlug:c,optionsKey:"loginOptions",options:null==h?void 0:h.loginOptions,setOption:e=>{m("loginOptions",{...null==h?void 0:h.loginOptions,...e})}})),(0,e.createElement)((()=>wpGraphQLLogin.hooks.applyFilters("graphql_login_custom_client_settings",(0,e.createElement)(e.Fragment,null),c,h)),null),(0,e.createElement)(n.Button,{isPrimary:!0,onClick:()=>{(async()=>{await p("root","site",void 0,{[c]:h})&&(0,s.dispatch)("core/notices").createNotice("success","Settings saved",{type:"snackbar",isDismissible:!0})})()}},(0,l.__)("Save.","wp-graphql-headless-login")))}function h(t){var n;let{provider:s}=t;const[o]=(0,a.useEntityProp)("root","site",s),i=null!==(n=null==o?void 0:o.isEnabled)&&void 0!==n&&n,r=i?(0,l.__)("Enabled.","wp-graphql-headless-login"):(0,l.__)("Disabled.","wp-graphql-headless-login");return(0,e.createElement)("div",{className:"wp-graphql-headless-login__menu__status-badge"},(0,e.createElement)("span",{className:"wp-graphql-headless-login__menu__status-badge--"+(i?"enabled":"disabled"),"aria-label":r,title:r}))}function u(t){var a;let{activeClient:s,setActiveClient:o}=t;const i=Object.keys((null===(a=wpGraphQLLogin)||void 0===a?void 0:a.settings)||{});return(0,e.createElement)(n.__experimentalNavigation,{activeItem:s},(0,e.createElement)(n.__experimentalNavigationMenu,{title:(0,l.__)("Providers.","wp-graphql-headless-login")},i.length>0&&i.map((t=>{var l,a;return(0,e.createElement)(n.__experimentalNavigationItem,{className:"wp-graphql-headless-login__menu__item",key:t,item:t,title:null===(l=wpGraphQLLogin)||void 0===l||null===(a=l.settings[t])||void 0===a?void 0:a.title,icon:(0,e.createElement)(h,{provider:t}),onClick:()=>o(t)})}))))}var _,m,v,E=window.React;function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},w.apply(this,arguments)}var b=function(e){return E.createElement("svg",w({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},e),_||(_=E.createElement("defs",null,E.createElement("filter",{id:"logo_svg__luminosity-invert-noclip",width:132.09,height:32766,x:64.02,y:-8591,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},E.createElement("feColorMatrix",{result:"invert",values:"-1 0 0 0 1 0 -1 0 0 1 0 0 -1 0 1 0 0 0 1 0"}),E.createElement("feFlood",{floodColor:"#fff",result:"bg"}),E.createElement("feBlend",{in:"invert",in2:"bg"})),E.createElement("style",null,".logo_svg__cls-6{fill:#f9921e}"),E.createElement("mask",{id:"logo_svg__mask",width:132.09,height:32766,x:64.02,y:-8591,maskUnits:"userSpaceOnUse"},E.createElement("g",{filter:"url(#logo_svg__luminosity-invert-noclip)"})))),m||(m=E.createElement("g",{id:"logo_svg__Banner"},E.createElement("path",{id:"logo_svg__Background",fill:"#dedede",d:"M186.03 164.84h1179.35v543.5H186.03z",opacity:.2,transform:"rotate(-30 775.697 436.587)"}))),v||(v=E.createElement("g",{id:"logo_svg__Logo"},E.createElement("path",{fill:"#43646b",d:"M189.12 106.23V71.3a61.45 61.45 0 0 0-122.89 0v1.22A4.74 4.74 0 0 0 71 77.26h16.46a4.74 4.74 0 0 0 4.74-4.74V71.3a35.48 35.48 0 1 1 71 0v34.94"}),E.createElement("path",{fill:"#0e2339",d:"M163.16 106.24H58.32a4.75 4.75 0 0 0-4.74 4.76l.1 114a4.74 4.74 0 0 0 4.74 4.74l137.22-.1a4.74 4.74 0 0 0 4.73-4.74v-114a4.76 4.76 0 0 0-1.4-3.36 4.7 4.7 0 0 0-3.34-1.37h-6.48"}),E.createElement("g",{mask:"url(#logo_svg__mask)"},E.createElement("path",{d:"M191.9 191.75a8.26 8.26 0 0 0-9.73 1.18c-1.55 1.54-2.08 2.7-2.75 5.95-.85 4-2.72 5.81-6.11 5.81a6 6 0 0 1-5.17-2.74c-.74-1.27-.78-2.22-1-26.33-.18-22.26-.27-25.33-.9-27.68-4.15-16-16.52-26.88-33-28.93-8.21-1-19 2.28-26.37 8.14a35.76 35.76 0 0 0-12.23 17.72l-1.15 3.32-4 1.45a33.68 33.68 0 0 0-14.35 8.84A35.93 35.93 0 0 0 66 172.9c-1.84 5.28-2 7.1-2 25.36v17.18l.88 1.71a9.36 9.36 0 0 0 5.35 4.22c.74.16 4.82.33 9.11.35 5.86 0 8.26-.12 9.74-.53A8.76 8.76 0 0 0 95 213c0-2.59 3.18-5.59 5.91-5.59 3.46 0 5.81 2.33 6.27 6.16a8.56 8.56 0 0 0 4.71 7.16c1.47.8 2 .85 10.84.85s9.39-.05 10.91-.85c1.85-1 3.9-3.19 4.29-4.71.21-.58.33-8.37.33-17.33v-16.28l-1-1.71c-1.64-2.86-3.51-3.88-8.19-4.5-6.37-.81-10-2.52-13.73-6.28a22 22 0 0 1-5.63-11c-1.24-7.33 2.4-15.55 8.82-19.82a18.26 18.26 0 0 1 11.35-3.5 16.37 16.37 0 0 1 6.43 1 20.54 20.54 0 0 1 11.22 9c2.74 4.66 2.67 3.42 2.9 31.61.21 23.05.33 25.58.95 27.52 2.05 6.37 6.32 11.56 11.51 14.1 7.13 3.48 14.12 3.71 20.33.69s11.28-10.24 12.59-18.18c.87-4.93-.33-7.81-3.91-9.59Zm-73.13-.85 2.84 1 .11 5.63a30 30 0 0 1-.18 5.63 9.26 9.26 0 0 1-1.82-2.33c-4-6.25-12-10.06-20-9.57a22.38 22.38 0 0 0-17.63 10.04l-1.39 2v-10.7c0-11.77.19-13.2 2.36-17.49 1.89-3.74 6.94-8.37 10.29-9.39.71-.23 1 .12 2.23 3.3a37.36 37.36 0 0 0 23.19 21.88Z",className:"logo_svg__cls-6"})),E.createElement("path",{d:"M132.84 170.69c1.69-1 2.34-1.87 3.22-4.45a12.86 12.86 0 0 0-.94-10.78 5.3 5.3 0 0 0-5.21-2.81 4.33 4.33 0 0 0-3.55 1.3c-4.23 3.65-4 13.36.39 16.43a6.2 6.2 0 0 0 6.09.31Z",className:"logo_svg__cls-6"}),E.createElement("path",{d:"M137.16 159.52a6.21 6.21 0 0 1-3.83 3.87 9.88 9.88 0 0 1-7.27-.25c-5.24-2.68-5.49-11.14-.46-14.33a6.37 6.37 0 0 1 4.22-1.1c3 0 4.61.6 6.21 2.42a8.63 8.63 0 0 1 1.13 9.39Z",className:"logo_svg__cls-6"}))))};function y(){var t;const[o,i]=(0,a.useEntityProp)("root","site","wpgraphql_login_settings_jwt_secret_key"),{saveEditedEntityRecord:r}=(0,s.useDispatch)(a.store),{lastError:c,isSaving:d}=(0,s.useSelect)((e=>({lastError:e(a.store).getLastEntitySaveError("root","site"),isSaving:e(a.store).isSavingEntityRecord("root","site"),hasEdits:e(a.store).hasEditsForEntityRecord("root","site")})),[o]);(0,e.useEffect)((()=>{c&&(0,s.dispatch)("core/notices").createErrorNotice((0,l.__)("The JWT secret could not be regenerated. Please try again later.","wp-graphql-headless-login"),{type:"snackbar",isDismissible:!0})}),[c,o]);const g=(null===(t=wpGraphQLLogin)||void 0===t?void 0:t.secret)||{},p=g.isConstant?(0,l.__)("Note: This value is set in wp-config.php and cannot be changed on the backend.","wp-graphql-headless-login"):"";return(0,e.createElement)(n.BaseControl,{className:"wp-graphql-headless-login__secret",id:"wp-graphql-headless-login__secret--control",help:(0,l.__)("The JWT Secret is used to sign the JWT tokens that are used to authenticate requests to the GraphQL API. Changing this secret will invalidate all previously-authenticated requests. ","wp-graphql-headless-login")+p},(0,e.createElement)(n.Button,{text:(0,l.__)("Regenerate JWT secret.","wp-graphql-headless-login"),icon:"admin-network",disabled:!!g.isConstant,isDestructive:!0,isBusy:d,iconSize:16,variant:"tertiary",onClick:()=>{i(""),(async()=>{await r("root","site",void 0,{wpgraphql_login_settings_jwt_secret_key:o})&&(0,s.dispatch)("core/notices").createNotice("success",(0,l.__)("The old JWT secret has been invalidated.","wp-graphql-headless-login"),{type:"snackbar",isDismissible:!0})})()}}))}function q(){const[t,o]=(0,a.useEntityProp)("root","site","wpgraphql_login_settings_delete_data_on_deactivate"),{saveEditedEntityRecord:i}=(0,s.useDispatch)(a.store);return(0,e.createElement)(n.PanelBody,null,(0,e.createElement)(n.PanelRow,null,(0,e.createElement)("h2",{className:"components-panel__body-title"},(0,l.__)("Plugin Settings.","wp-graphql-headless-login"),(0,e.createElement)(n.Icon,{icon:"admin-tools",className:"components-panel__icon",size:20}))),(0,e.createElement)(y,null),void 0!==t&&(0,e.createElement)(n.ToggleControl,{className:"wp-graphql-headless-login__delete-on-deactivate-toggle",label:(0,l.__)("Delete plugin data on deactivate","wp-graphql-headless-login"),checked:t,onChange:e=>{o(e),i("root","site",void 0,{wpgraphql_login_settings_delete_data_on_deactivate:e})},help:(0,l.__)("When selected, all plugin data will be deleted when the plugin is deactivated, including client configurations. Mote: No user meta will be deleted.","wp-graphql-headless-login")}),(0,e.createElement)((()=>wpGraphQLLogin.hooks.applyFilters("graphql_login_custom_plugin_options",(0,e.createElement)(e.Fragment,null))),null))}const f=()=>{const t=(0,s.useSelect)((e=>e(o.store).getNotices().filter((e=>"snackbar"===e.type))),[]),{removeNotice:l}=(0,s.useDispatch)(o.store);return(0,e.createElement)(n.SnackbarList,{className:"edit-site-notices",notices:t,onRemove:l})};var k=function(){var t,o;const[i,r]=(0,a.useEntityProp)("root","site","wpgraphql_login_settings_show_advanced_settings"),{saveEditedEntityRecord:c}=(0,s.useDispatch)(a.store),[d,g]=(0,e.useState)((null===(t=Object.keys(null===(o=wpGraphQLLogin)||void 0===o?void 0:o.settings))||void 0===t?void 0:t[0])||null);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wp-graphql-headless-login__header"},(0,e.createElement)("h1",{className:"wp-graphql-headless-login__title"},(0,e.createElement)(n.Icon,{icon:(0,e.createElement)(b,null)}),(0,l.__)("Headless Login Settings","wp-graphql-headless-login")," "),void 0!==i&&(0,e.createElement)(n.ToggleControl,{className:"wp-graphql-headless-login__advanced-settings-toggle",label:(0,l.__)("Show advanced settings","wp-graphql-headless-login"),checked:i,onChange:e=>{r(e),c("root","site",void 0,{wpgraphql_login_settings_show_advanced_settings:e})}}),(0,e.createElement)("div",{className:"wp-graphql-headless-login__documentation-link"},(0,e.createElement)("a",{href:"https://github.com/AxeWP/wp-graphql-headless-login-beta/blob/main/docs/settings.md",target:"_blank",rel:"noreferrer"},(0,l.__)("Documentation (WIP).","wp-graphql-headless-login"),(0,e.createElement)(n.Icon,{icon:"external",className:"wp-graphql-headless-login__documentation-link-icon"})))),(0,e.createElement)(n.Flex,{className:"wp-graphql-headless-login__main",align:"flex-start"},(0,e.createElement)(n.FlexItem,{className:"wp-graphql-headless-login__sidebar"},(0,e.createElement)(u,{activeClient:d,setActiveClient:g})),(0,e.createElement)(n.FlexBlock,null,(0,e.createElement)(n.Panel,{className:"wp-graphql-headless-login__client"},d?(0,e.createElement)(p,{key:`client-${d}`,clientSlug:d}):(0,e.createElement)(n.Placeholder,{icon:(0,e.createElement)(n.Icon,{icon:(0,e.createElement)(b,null)}),title:(0,l.__)("No clients found","wp-graphql-headless-login"),instructions:(0,l.__)("@todo: add instructions. This should be some nice onboardy stuff with links to docs etc.","wp-graphql-headless-login")})))),(0,e.createElement)(n.Panel,{className:"wp-graphql-headless-login__plugin-settings"},(0,e.createElement)(q,null)),(0,e.createElement)("div",{className:"wp-graphql-headless-login__notices"},(0,e.createElement)(f,null)))};const N=(0,t.createHooks)();document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("wpgraphql_login_settings");t&&(0,e.render)((0,e.createElement)(k,null),t)})),wpGraphQLLogin.hooks=N}();